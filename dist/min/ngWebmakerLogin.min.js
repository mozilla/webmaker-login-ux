!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function request(options,callback){if("function"!=typeof callback)throw new Error("Bad callback given: "+callback);if(!options)throw new Error("No options given");var options_onResponse=options.onResponse;if(options="string"==typeof options?{uri:options}:JSON.parse(JSON.stringify(options)),options.onResponse=options_onResponse,options.verbose&&(request.log=getLogger()),options.url&&(options.uri=options.url,delete options.url),!options.uri&&""!==options.uri)throw new Error("options.uri is a required argument");if("string"!=typeof options.uri)throw new Error("options.uri must be a string");for(var unsupported_options=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],i=0;i<unsupported_options.length;i++)if(options[unsupported_options[i]])throw new Error("options."+unsupported_options[i]+" is not supported");if(options.callback=callback,options.method=options.method||"GET",options.headers=options.headers||{},options.body=options.body||null,options.timeout=options.timeout||request.DEFAULT_TIMEOUT,options.headers.host)throw new Error("Options.headers.host is not supported");options.json&&(options.headers.accept=options.headers.accept||"application/json","GET"!==options.method&&(options.headers["content-type"]="application/json"),"boolean"!=typeof options.json?options.body=JSON.stringify(options.json):"string"!=typeof options.body&&(options.body=JSON.stringify(options.body)));var serialize=function(obj){var str=[];for(var p in obj)obj.hasOwnProperty(p)&&str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")};if(options.qs){var qs="string"==typeof options.qs?options.qs:serialize(options.qs);options.uri.indexOf("?")!==-1?options.uri=options.uri+"&"+qs:options.uri=options.uri+"?"+qs}var multipart=function(obj){var result={};result.boundry="-------------------------------"+Math.floor(1e9*Math.random());var lines=[];for(var p in obj)obj.hasOwnProperty(p)&&lines.push("--"+result.boundry+'\nContent-Disposition: form-data; name="'+p+'"\n\n'+obj[p]+"\n");return lines.push("--"+result.boundry+"--"),result.body=lines.join(""),result.length=result.body.length,result.type="multipart/form-data; boundary="+result.boundry,result};if(options.form){if("string"==typeof options.form)throw"form name unsupported";if("POST"===options.method){var encoding=(options.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(options.headers["content-type"]=encoding,encoding){case"application/x-www-form-urlencoded":options.body=serialize(options.form).replace(/%20/g,"+");break;case"multipart/form-data":var multi=multipart(options.form);options.body=multi.body,options.headers["content-type"]=multi.type;break;default:throw new Error("unsupported encoding:"+encoding)}}}return options.onResponse=options.onResponse||noop,options.onResponse===!0&&(options.onResponse=callback,options.callback=noop),!options.headers.authorization&&options.auth&&(options.headers.authorization="Basic "+b64_enc(options.auth.username+":"+options.auth.password)),run_xhr(options)}function run_xhr(options){function too_late(){timed_out=!0;var er=new Error("ETIMEDOUT");return er.code="ETIMEDOUT",er.duration=options.timeout,request.log.error("Timeout",{id:xhr._id,milliseconds:options.timeout}),options.callback(er,xhr)}function on_state_change(event){if(timed_out)return request.log.debug("Ignoring timed out state change",{state:xhr.readyState,id:xhr.id});if(request.log.debug("State change",{state:xhr.readyState,id:xhr.id,timed_out:timed_out}),xhr.readyState===XHR.OPENED){request.log.debug("Request started",{id:xhr.id});for(var key in options.headers)xhr.setRequestHeader(key,options.headers[key])}else xhr.readyState===XHR.HEADERS_RECEIVED?on_response():xhr.readyState===XHR.LOADING?(on_response(),on_loading()):xhr.readyState===XHR.DONE&&(on_response(),on_loading(),on_end())}function on_response(){if(!did.response){if(did.response=!0,request.log.debug("Got response",{id:xhr.id,status:xhr.status}),clearTimeout(xhr.timeoutTimer),xhr.statusCode=xhr.status,is_cors&&0==xhr.statusCode){var cors_err=new Error("CORS request rejected: "+options.uri);return cors_err.cors="rejected",did.loading=!0,did.end=!0,options.callback(cors_err,xhr)}options.onResponse(null,xhr)}}function on_loading(){did.loading||(did.loading=!0,request.log.debug("Response body loading",{id:xhr.id}))}function on_end(){if(!did.end){if(did.end=!0,request.log.debug("Request done",{id:xhr.id}),xhr.body=xhr.responseText,options.json)try{xhr.body=JSON.parse(xhr.responseText)}catch(er){return options.callback(er,xhr)}options.callback(null,xhr,xhr.body)}}var xhr=new XHR,timed_out=!1,is_cors=is_crossDomain(options.uri),supports_cors="withCredentials"in xhr;if(req_seq+=1,xhr.seq_id=req_seq,xhr.id=req_seq+": "+options.method+" "+options.uri,xhr._id=xhr.id,is_cors&&!supports_cors){var cors_err=new Error("Browser does not support cross-origin request: "+options.uri);return cors_err.cors="unsupported",options.callback(cors_err,xhr)}xhr.timeoutTimer=setTimeout(too_late,options.timeout);var did={response:!1,loading:!1,end:!1};return xhr.onreadystatechange=on_state_change,xhr.open(options.method,options.uri,!0),is_cors&&(xhr.withCredentials=!!options.withCredentials),xhr.send(options.body),xhr}function noop(){}function getLogger(){var level,i,logger={},levels=["trace","debug","info","warn","error"];for(i=0;i<levels.length;i++)level=levels[i],logger[level]=noop,"undefined"!=typeof console&&console&&console[level]&&(logger[level]=formatted(console,level));return logger}function formatted(obj,method){function formatted_logger(str,context){return"object"==typeof context&&(str+=" "+JSON.stringify(context)),obj[method].call(obj,str)}return formatted_logger}function is_crossDomain(url){var ajaxLocation,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}var ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],parts=rurl.exec(url.toLowerCase()),result=!(!parts||parts[1]==ajaxLocParts[1]&&parts[2]==ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?80:443))==(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?80:443)));return result}function b64_enc(data){var o1,o2,o3,h1,h2,h3,h4,bits,b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,ac=0,enc="",tmp_arr=[];if(!data)return data;do o1=data.charCodeAt(i++),o2=data.charCodeAt(i++),o3=data.charCodeAt(i++),bits=o1<<16|o2<<8|o3,h1=bits>>18&63,h2=bits>>12&63,h3=bits>>6&63,h4=63&bits,tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);while(i<data.length);switch(enc=tmp_arr.join(""),data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"="}return enc}var XHR=XMLHttpRequest;if(!XHR)throw new Error("missing XMLHttpRequest");request.log={trace:noop,debug:noop,info:noop,warn:noop,error:noop};var DEFAULT_TIMEOUT=18e4,req_seq=0;request.withCredentials=!1,request.DEFAULT_TIMEOUT=DEFAULT_TIMEOUT,request.defaults=function(options,requester){var def=function(method){var d=function(params,callback){params="string"==typeof params?{uri:params}:JSON.parse(JSON.stringify(params));for(var i in options)void 0===params[i]&&(params[i]=options[i]);return method(params,callback)};return d},de=def(request);return de.get=def(request.get),de.post=def(request.post),de.put=def(request.put),de.head=def(request.head),de};var shortcuts=["get","put","post","head"];shortcuts.forEach(function(shortcut){var method=shortcut.toUpperCase(),func=shortcut.toLowerCase();request[func]=function(opts){"string"==typeof opts?opts={method:method,uri:opts}:(opts=JSON.parse(JSON.stringify(opts)),opts.method=method);var args=[opts].concat(Array.prototype.slice.apply(arguments,[1]));return request.apply(this,args)}}),request.couch=function(options,callback){function couch_handler(er,resp,body){if(er)return callback(er,resp,body);if((resp.statusCode<200||resp.statusCode>299)&&body.error){er=new Error("CouchDB error: "+(body.error.reason||body.error.error));for(var key in body)er[key]=body[key];return callback(er,resp,body)}return callback(er,resp,body)}"string"==typeof options&&(options={uri:options}),options.json=!0,options.body&&(options.json=options.body),delete options.body,callback=callback||noop;var xhr=request(options,couch_handler);return xhr},module.exports=request},{}],2:[function(require,module,exports){!function(){var cookiejs={serialize:function(name,val,opt){opt=opt||{};var enc=opt.encode||encode,pairs=[name+"="+enc(val)];if(null!=opt.maxAge){var maxAge=opt.maxAge-0;if(isNaN(maxAge))throw new Error("maxAge should be a Number");pairs.push("Max-Age="+maxAge)}return opt.domain&&pairs.push("Domain="+opt.domain),opt.path&&pairs.push("Path="+opt.path),opt.expires&&pairs.push("Expires="+opt.expires.toUTCString()),opt.httpOnly&&pairs.push("HttpOnly"),opt.secure&&pairs.push("Secure"),pairs.join("; ")},parse:function(str,opt){opt=opt||{};var obj={},pairs=str.split(/; */),dec=opt.decode||decode;return pairs.forEach(function(pair){var eq_idx=pair.indexOf("=");if(!(eq_idx<0)){var key=pair.substr(0,eq_idx).trim(),val=pair.substr(++eq_idx,pair.length).trim();if('"'==val[0]&&(val=val.slice(1,-1)),void 0==obj[key])try{obj[key]=dec(val)}catch(e){obj[key]=val}}}),obj}},encode=encodeURIComponent,decode=decodeURIComponent;"undefined"!=typeof module&&module.exports?module.exports=cookiejs:"function"==typeof define&&define.amd?define(function(){return cookiejs}):window.cookiejs=cookiejs}()},{}],3:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],4:[function(require,module,exports){!function(global,factory){"function"==typeof define&&define.amd?define(factory):"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=factory():global.analytics=factory()}(this,function(){function toTitleCase(s){var smallWords=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return s=trim(s),s.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(match,index,title){return index>0&&index+match.length!==title.length&&match.search(smallWords)>-1&&":"!==title.charAt(index-2)&&("-"!==title.charAt(index+match.length)||"-"===title.charAt(index-1))&&title.charAt(index-1).search(/[^\s-]/)<0?match.toLowerCase():match.substr(1).search(/[A-Z]|\../)>-1?match:match.charAt(0).toUpperCase()+match.substr(1)})}function trim(s){return s.replace(/^\s+|\s+$/g,"")}function mightBeEmail(s){return/[^@]+@[^@]+/.test(s)}function warn(msg){console.warn("[analytics] "+msg)}function _gaEvent(options){if("function"==typeof ga){var fieldObject={hitType:"event",eventCategory:_category,eventAction:options.action};options.label&&(fieldObject.eventLabel=options.label),(options.value||0===options.value)&&(fieldObject.eventValue=options.value),options.nonInteraction===!0&&(fieldObject.nonInteraction=1),ga("send",fieldObject)}var eventArgs=["_trackEvent",_category,options.action];options.label&&(eventArgs[3]=options.label),(options.value||0===options.value)&&(eventArgs[4]=options.value),options.nonInteraction===!0&&(eventArgs[5]=!0),_gaq.push(eventArgs)}function event(action,options){options=options||{};var eventOptions={},label=options.label,value=options.value,nonInteraction=options.noninteraction||options.nonInteraction;return action?(mightBeEmail(action)&&(warn("`action` arg looks like an email address, redacting."),action=_redacted),eventOptions.action=toTitleCase(action),label&&("string"!=typeof label?warn("Expected `label` arg to be a String."):(mightBeEmail(label)&&(warn("`label` arg looks like an email address, redacting."),label=_redacted),eventOptions.label=trim(label))),(value||0===value)&&("number"!=typeof value?warn("Expected `value` arg to be a Number."):eventOptions.value=0|value),nonInteraction&&("boolean"!=typeof nonInteraction?warn("Expected `noninteraction` arg to be a Boolean."):eventOptions.nonInteraction=nonInteraction===!0),void _gaEvent(eventOptions)):void warn("Expected `action` arg.")}function prefixVirtualPageview(s){return/^\/virtual\//.test(s)?s:(s=s.replace(/^[\/]?/,"/"),"/virtual"+s)}function _gaVirtualPageView(options){if("function"==typeof ga){var fieldObject={hitType:"pageview",page:options.virtualPagePath};ga("send",fieldObject)}var eventArgs=["_trackPageview",options.virtualPagePath];_gaq.push(eventArgs)}function virtualPageview(virtualPagePath){if(!virtualPagePath)return void warn("Expected `virtualPagePath` arg.");virtualPagePath=trim(virtualPagePath);var eventOptions={};eventOptions.virtualPagePath=prefixVirtualPageview(virtualPagePath),_gaVirtualPageView(eventOptions)}function _optimizely(options){var eventArgs=["trackEvent",options.action];if(options.revenue){var args={revenue:options.revenue};eventArgs[2]=args}optimizely.push(eventArgs)}function conversionGoal(action,options){options=options||{};var eventOptions={},valueInCents=options.valueInCents;return action?(eventOptions.action=trim(action),valueInCents&&("number"==typeof valueInCents&&valueInCents%1===0?eventOptions.revenue=valueInCents:warn("Expected `valueInCents` arg to be an integer.")),void _optimizely(eventOptions)):void warn("Expected `action` arg.")}this._gaq||(this._gaq=[]),this.optimizely||(this.optimizely=[]);var _category=location.hostname,_redacted="REDACTED (Potential Email Address)";return{event:event,virtualPageview:virtualPageview,conversionGoal:conversionGoal}})},{}],5:[function(require,module,exports){var ngModule=angular.module("ngWebmakerLogin",["templates-ngWebmakerLogin"]);ngModule.factory("loginOptions",["$rootScope",function($rootScope){return window.angularConfig?{csrfToken:window.angularConfig.csrf,paths:window.angularConfig.loginPaths}:window.eventsConfig?{csrfToken:window.eventsConfig.csrf,paths:window.eventsConfig.loginPaths}:$rootScope.WMP.config?{csrfToken:$rootScope.WMP.config.csrf,paths:$rootScope.WMP.config.loginPaths}:(console.warn("Could not locate a config on window.angularConfig, window.eventsConfig or $rootScope.WMP.config"),{})}]),ngModule.factory("focus",["$timeout",function($timeout){return function(selector){$timeout(function(){var el=angular.element(selector);el&&el[0]&&el[0].focus()},0)}}]),ngModule.directive("bindTrustedHtml",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.bindTrustedHtml)},function(value){element.html(value),$compile(element.contents())(scope)})}}]),ngModule.factory("wmLoginCore",["$rootScope","$location","$timeout","loginOptions",function($rootScope,$location,$timeout,loginOptions){function scrubSearch(){$location.search("uid",null),$location.search("token",null),$location.search("validFor",null)}var LoginCore=require("../core"),core=new LoginCore(loginOptions),searchObj=$location.search();return $rootScope._user={},searchObj.uid&&searchObj.token&&(core.on("signedIn",function(user){$timeout(function(){scrubSearch(),$rootScope._user=user},0)}),core.on("signinFailed",function(uid){$timeout(function(){console.error("login failed for uid: "+uid),scrubSearch(),$rootScope.expiredLoginLink=!0,$rootScope.signin(uid)},0)}),core.instantLogin(searchObj.uid,searchObj.token,searchObj.validFor)),core.on("verified",function(user){$timeout(function(){$rootScope._user=user?user:{},$rootScope.$broadcast("verified",user)},0)}),core.verify(),core}]),ngModule.directive("wmJoinWebmaker",[function(){return{restrict:"A",scope:{showCTA:"=showcta"},link:function($scope,$element){$element.on("click",function(){$scope.joinWebmaker()})},controller:["$rootScope","$scope","$modal","$timeout","focus","wmLoginCore",function($rootScope,$scope,$modal,$timeout,focus,wmLoginCore){function joinModalController($scope,$modalInstance,email,username,showCTA,agreeToTerms){var MODALSTATE={inputEmail:0,inputUsername:1,welcome:2};$scope.MODALSTATE=MODALSTATE,$scope.currentState=MODALSTATE.inputEmail,$scope.form={},$scope.user={},$scope.sendingRequest=!1;var joinController=wmLoginCore.joinWebmaker(showCTA);email&&($scope.user.email=email),username&&($scope.user.username=username),$scope.user.agree=agreeToTerms,joinController.on("sendingRequest",function(state){$timeout(function(){$scope.sendingRequest=state},0)}),joinController.on("displayEmailInput",function(){$timeout(function(){$scope.currentState=MODALSTATE.inputEmail,focus('input[focus-on="create-user-email"]'),void 0!==$scope.user.email&&joinController.validateEmail($scope.user.email)&&void 0!==$scope.user.agree&&(joinController.submitEmail($scope.user.agree),$scope.user.agree&&($scope.skippedEmail=!0,joinController.validateUsername(username)))},0)}),joinController.on("displayUsernameInput",function(){$timeout(function(){$scope.currentState=MODALSTATE.inputUsername,focus('input[focus-on="create-user-username"]')},0)}),joinController.on("displayWelcome",function(user,showCTA){$timeout(function(){$rootScope._user=user,showCTA?$scope.welcomeModalIdx=0:$scope.simpleCTA=!0,$scope.currentState=MODALSTATE.welcome},0)}),joinController.on("displayAlert",function(alertId){$timeout(function(){$scope.form.user.$setValidity(alertId,!1)},0)}),joinController.on("hideAlert",function(alertId){$timeout(function(){$scope.form.user.$setValidity(alertId,!0)},0)}),$scope.validateEmail=function(){$scope.user.email&&joinController.validateEmail($scope.user.email)},$scope.submitEmail=function(){joinController.submitEmail($scope.user.agree)},$scope.agreeToTermsChanged=function(){joinController.agreeToTermsChanged($scope.user.agree)},$scope.validateUsername=function(){joinController.validateUsername($scope.user.username)},$scope.submitUser=function(){joinController.submitUser($scope.user)},$scope.close=function(){$modalInstance.close()},$scope.switchToSignin=function(){$modalInstance.close(),$rootScope.signin($scope.user.email)},joinController.start()}$scope.joinWebmaker=$rootScope.joinWebmaker=function(email,username,agreeToTerms){$modal.open({templateUrl:"join-webmaker-modal.html",controller:["$scope","$modalInstance","email","username","showCTA","agreeToTerms",joinModalController],resolve:{email:function(){return email},username:function(){return username},showCTA:function(){return!!$scope.showCTA},agreeToTerms:function(){return agreeToTerms}}})}}]}}]),ngModule.directive("wmSignin",[function(){return{restrict:"A",scope:{disablePersona:"=disablepersona"},link:function($scope,$element){$element.on("click",function(){$scope.signin()})},controller:["$rootScope","$scope","$modal","$timeout","$location","focus","wmLoginCore",function($rootScope,$scope,$modal,$timeout,$location,focus,wmLoginCore){function signinModalController($scope,$modalInstance,uid,passwordWasReset,disablePersona){var MODALSTATE={enterUid:0,checkEmail:1,enterKey:2,enterPassword:3,resetRequestSent:4,enterEmail:5};$scope.MODALSTATE=MODALSTATE,$scope.currentState=MODALSTATE.enterUid,$scope.enterEmail=enterEmail,$scope.passwordWasReset=passwordWasReset,$scope.sendingRequest=!1,$scope.disablePersona=disablePersona,$scope.form={},$scope.user={},uid&&($scope.user.uid=uid);var signinController=wmLoginCore.signIn();signinController.on("sendingRequest",function(state){$timeout(function(){$scope.sendingRequest=state},0)}),signinController.on("displayEnterUid",function(){$timeout(function(){$scope.currentState=MODALSTATE.enterUid,focus('input[focus-on="login-uid"]')},0)}),signinController.on("displayEnterEmail",function(){$timeout(function(){$scope.currentState=MODALSTATE.enterEmail,focus('input[focus-on="login-uid2"]')},0)}),signinController.on("displayEnterPassword",function(){$timeout(function(){$scope.currentState=MODALSTATE.enterPassword,focus('input[focus-on="enter-password"]')},0)}),signinController.on("displayEnterKey",function(verified){$timeout(function(){$scope.verified=verified,$scope.currentState=MODALSTATE.enterKey,focus('input[focus-on="enter-key"]')},0)}),signinController.on("displayCheckEmail",function(){$timeout(function(){$scope.currentState=MODALSTATE.checkEmail},0)}),signinController.on("displayResetSent",function(){$timeout(function(){$scope.currentState=MODALSTATE.resetRequestSent},0)}),signinController.on("displayAlert",function(alertId){$timeout(function(){$scope.form.user.$setValidity(alertId,!1)},0)}),signinController.on("hideAlert",function(alertId){$timeout(function(){$scope.form.user.$setValidity(alertId,!0)},0)}),signinController.on("signedIn",function(user){$rootScope._user=user,$modalInstance.close(),$rootScope.$broadcast("login",user)}),$scope.submitUid=function(){signinController.submitUid($scope.user.uid,$location.path())},$scope.enterKey=function(){signinController.displayEnterKey()},$scope.enterEmail=function(){signinController.displayEnterEmail()},$scope.submitKey=function(){signinController.verifyKey($scope.user.uid,$scope.user.key,$scope.user.rememberMe)},$scope.submitPassword=function(){signinController.verifyPassword($scope.user.uid,$scope.user.password,$scope.user.rememberMe)},$scope.requestReset=function(){signinController.requestReset($scope.user.uid)},$scope.close=function(){$scope.user={},$modalInstance.close()},$scope.switchToSignup=function(){var uid=$scope.user.uid,type=($scope.user.id,signinController.getUidType(uid)),email="email"===type?uid:"",username="username"===type?uid:"";$modalInstance.close(),$rootScope.joinWebmaker(email,username)},$scope.usePersona=function(){$rootScope.personaLogin(),$timeout($modalInstance.dismiss,0)},signinController.start()}$scope.signin=$rootScope.signin=function(uid,passwordWasReset){$modal.open({templateUrl:"signin-modal.html",controller:["$scope","$modalInstance","uid","passwordWasReset",signinModalController],resolve:{uid:function(){return uid},passwordWasReset:function(){return passwordWasReset},disablePersona:function(){return $scope.disablePersona}},backdrop:"static",keyboard:!1})}}]}}]),ngModule.directive("wmPasswordReset",[function(){var triggered=!1;return{restrict:"A",controller:["$rootScope","$scope","$location","$timeout","$modal","wmLoginCore",function($rootScope,$scope,$location,$timeout,$modal,wmLoginCore){function passwordResetModalController($scope,$modalInstance,resetCode,uid){function clearSearch(){$location.search("uid",null),$location.search("resetCode",null),$modalInstance.close()}$scope.form={},$scope.password={},$scope.sendingRequest=!1,$scope.eightChars=angular.element("li.eight-chars"),$scope.oneEachCase=angular.element("li.one-each-case"),$scope.oneNumber=angular.element("li.one-number");var resetController=wmLoginCore.resetPassword();resetController.on("sendingRequest",function(state){$timeout(function(){$scope.sendingRequest=state},0)}),resetController.on("displayAlert",function(alertId){$timeout(function(){$scope.form.password.$setValidity(alertId,!1)},0)}),resetController.on("hideAlert",function(alertId){$timeout(function(){$scope.form.password.$setValidity(alertId,!0)},0)}),resetController.on("checkConfirmPassword",function(status){$timeout(function(){$scope.passwordsMatch=status},0)}),resetController.on("passwordCheckResult",function(result,blur){$timeout(function(){return result?($scope.eightCharsState=result.lengthValid?blur?"valid":"":"invalid",$scope.oneEachCaseState=result.caseValid?blur?"valid":"":"invalid",$scope.oneNumberState=result.digitValid?blur?"valid":"":"invalid",void($scope.isValidPassword=result.lengthValid&&result.caseValid&&result.digitValid)):($scope.eightCharsState=$scope.oneEachCaseState=$scope.oneNumberState="default",void($scope.isValidPassword=!1))},0)}),resetController.on("resetSucceeded",function(){$timeout(function(){clearSearch(),$rootScope.signin(uid,!0)},0)}),$scope.checkPasswordStrength=function(blur){resetController.checkPasswordStrength($scope.password.value,blur)},$scope.checkPasswordsMatch=function(blur){$scope.password.confirmValue&&resetController.passwordsMatch($scope.password.value,$scope.password.confirmValue,blur)},$scope.submitResetRequest=function(){var uid=$scope.user.uid;resetController.submitResetRequest(uid,resetCode,$scope.password.value)},$scope.close=function(){clearSearch(),$modalInstance.close()}}var searchObj=$location.search();searchObj.resetCode&&searchObj.uid&&!triggered&&(triggered=!0,$modal.open({templateUrl:"reset-modal.html",controller:["$scope","$modalInstance","resetCode","uid",passwordResetModalController],resolve:{resetCode:function(){return searchObj.resetCode},uid:function(){return searchObj.uid}}}))}]}}]),ngModule.factory("wmPersona",["$rootScope","wmLoginCore",function($rootScope,wmLoginCore){var personaController=wmLoginCore.personaLogin();$rootScope.personaLogin=function(){personaController.authenticate()},personaController.on("signedIn",function(user){$rootScope._user=user}),personaController.on("newUser",function(email){$rootScope.joinWebmaker(email)})}]),ngModule.directive("wmPersonaLogin",["wmPersona",function(){return{restrict:"A",link:function($scope,$element){$element.on("click",function(){$scope.personaLogin()})}}}]),ngModule.directive("wmLogout",["$timeout","wmLoginCore",function($timeout){return{restrict:"A",link:function($rootScope,$element){$element.on("click",function(){$rootScope.logout()})},controller:["$rootScope","wmLoginCore",function($rootScope,wmLoginCore){var logoutController=wmLoginCore.logout();logoutController.on("loggedOut",function(){$timeout(function(){$rootScope._user={},$rootScope.$broadcast("logout")},0)}),$rootScope.logout=function(){logoutController.logout()}}]}}])},{"../core":6}],6:[function(require,module,exports){var state=require("./state"),LoginAPI=require("./loginAPI"),Emitter=require("./state/emitter");module.exports=function(options){function verify(){loginAPI.verify(function(err,resp,body){if(err)return emitter.emit("error",err);try{body=JSON.parse(body)}catch(ex){return emitter.emit("error","could not parse json from verify route")}emitter.emit("verified",body.user)})}var loginAPI=new LoginAPI(options),emitter=new Emitter;return{on:function(event,listener){emitter.on(event,listener)},off:function(event,listener){emitter.off(event,listener)},joinWebmaker:function(showCTA){return new state.JoinController(loginAPI,(!!showCTA))},signIn:function(){return new state.SignInController(loginAPI)},resetPassword:function(){return new state.ResetController(loginAPI)},personaLogin:function(){return new state.PersonaController(loginAPI)},logout:function(){return new state.LogoutController(loginAPI)},instantLogin:function(uid,password,validFor){loginAPI.verifyKey(uid,password,validFor,function(err,resp,body){return err||200!==resp.status||!body.user?emitter.emit("signinFailed",uid):void emitter.emit("signedIn",body.user)})},verify:verify}}},{"./loginAPI":7,"./state":11,"./state/emitter":10}],7:[function(require,module,exports){var request=require("browser-request");module.exports=function(options){function doRequest(uri,payload,callback){request({method:"post",uri:uri,timeout:timeout,withCredentials:withCredentials,headers:headers,json:payload},callback)}function uidExists(uid,callback){doRequest(loginUrls.uidExists,{uid:uid},callback)}function checkUsername(username,callback){doRequest(loginUrls.checkUsername,{username:username},callback)}function createUser(user,callback){user.referrer=refferals.refValue(),doRequest(loginUrls.createUser,{
user:user,audience:audience},function(){refferals.clearReferrerCookie(),callback.apply(null,arguments)})}function sendLoginKey(uid,path,callback){doRequest(loginUrls.request,{uid:uid,path:path},callback)}function verifyKey(uid,key,validFor,callback){doRequest(loginUrls.authenticateToken,{uid:uid,token:key,validFor:validFor,user:{referrer:refferals.refValue()}},function(){refferals.clearReferrerCookie(),callback.apply(null,arguments)})}function verifyPassword(uid,password,validFor,callback){doRequest(loginUrls.verifyPassword,{uid:uid,password:password,validFor:validFor,user:{referrer:refferals.refValue()}},function(){refferals.clearReferrerCookie(),callback.apply(null,arguments)})}function requestReset(uid,callback){doRequest(loginUrls.requestResetCode,{uid:uid},callback)}function requestEmail(uid,callback){doRequest(loginUrls.requestResetCode,{uid:uid},callback)}function resetPassword(uid,resetCode,password,callback){doRequest(loginUrls.resetPassword,{uid:uid,resetCode:resetCode,newPassword:password},callback)}function personaLogin(assertion,callback){doRequest(loginUrls.authenticate,{assertion:assertion,audience:audience,user:{referrer:refferals.refValue()}},callback)}function logout(callback){doRequest(loginUrls.logout,null,callback)}function verify(callback){doRequest(loginUrls.verify,null,callback)}options=options||{},options.paths=options.paths||{};var refferals=require("./referrals.js")(),loginUrls=require("./loginUrls.js")(options),withCredentials=options.withCredentials!==!1,timeout=1e3*(options.timeout||10),headers={"X-CSRF-Token":options.csrfToken},audience=options.audience||window.location.protocol+"//"+window.location.host;return{uidExists:uidExists,checkUsername:checkUsername,createUser:createUser,sendLoginKey:sendLoginKey,verifyKey:verifyKey,verifyPassword:verifyPassword,requestReset:requestReset,requestEmail:requestEmail,resetPassword:resetPassword,personaLogin:personaLogin,logout:logout,verify:verify}}},{"./loginUrls.js":8,"./referrals.js":9,"browser-request":1}],8:[function(require,module,exports){module.exports=function(options){var paths={},host=options.host||"";return paths=options.paths||{},paths.authenticate=options.paths.authenticate||"/authenticate",paths.legacyCreate=options.paths.legacyCreate||"/create",paths.verify=options.paths.verify||"/verify",paths.logout=options.paths.logout||"/logout",paths.checkUsername=options.paths.checkUsername||"/check-username",paths.request=options.paths.request||"/auth/v2/request",paths.uidExists=options.paths.uidExists||"/auth/v2/uid-exists",paths.createUser=options.paths.createUser||"/auth/v2/create",paths.authenticateToken=options.paths.authenticateToken||"/auth/v2/authenticateToken",paths.verifyPassword=options.paths.verifyPassword||"/auth/v2/verify-password",paths.requestResetCode=options.paths.requestResetCode||"/auth/v2/request-reset-code",paths.removePassword=options.paths.removePassword||"/auth/v2/remove-password",paths.enablePasswords=options.paths.enablePasswords||"/auth/v2/enable-passwords",paths.resetPassword=options.paths.resetPassword||"/auth/v2/reset-password",{request:host+paths.request,authenticateToken:host+paths.authenticateToken,authenticate:host+paths.authenticate,legacyCreate:host+paths.legacyCreate,createUser:host+paths.createUser,verify:host+paths.verify,logout:host+paths.logout,uidExists:host+paths.uidExists,checkUsername:host+paths.checkUsername,verifyPassword:host+paths.verifyPassword,requestResetCode:host+paths.requestResetCode,removePassword:host+paths.removePassword,enablePasswords:host+paths.enablePasswords,resetPassword:host+paths.resetPassword}}},{}],9:[function(require,module,exports){var cookiejs=require("cookie-js");module.exports=function(){var referralCookieSettings={domain:location.hostname.split(".").slice(-2).join("."),path:"/",secure:"https:"===location.protocol,expires:new Date(Date.now()+6048e5)},refValue=/ref=((?:\w|-)+)/.exec(window.location.search),cookieRefValue=cookiejs.parse(document.cookie).webmakerReferral;return refValue&&(refValue=refValue[1],cookieRefValue!==refValue&&(document.cookie=cookiejs.serialize("webmakerReferral",refValue,referralCookieSettings),cookieRefValue=refValue)),{clearReferrerCookie:function(){referralCookieSettings.expires=new Date(Date.now()-1e4),document.cookie=cookiejs.serialize("webmakerReferral","expire",referralCookieSettings),referralCookieSettings.expires=new Date(Date.now()+6048e5)},refValue:function(){return cookieRefValue}}}},{"cookie-js":2}],10:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;module.exports=function(){var emitter=new EventEmitter;return{on:function(event,listener){emitter.addListener(event,listener)},off:function(event,listener){return listener?void emitter.removeListener(event,listener):void emitter.removeAllListeners(event)},emit:function(){emitter.emit.apply(emitter,arguments)}}}},{events:3}],11:[function(require,module,exports){module.exports={JoinController:require("./join.js"),SignInController:require("./signin.js"),ResetController:require("./reset.js"),PersonaController:require("./persona.js"),LogoutController:require("./logout.js")}},{"./join.js":12,"./logout.js":13,"./persona.js":14,"./reset.js":15,"./signin.js":16}],12:[function(require,module,exports){var Emitter=require("./emitter.js"),validation=require("../validation"),analytics=require("webmaker-analytics");module.exports=function(loginApi,showCTA){function emit(){emitter.emit.apply(emitter,arguments)}function setRequestState(state){emit(JOIN_EVENTS.sendingRequest,state,!state)}function displayAlert(alertId,forceUpdate){emit(JOIN_EVENTS.displayAlert,alertId,forceUpdate)}function clearAlerts(alerts){alerts=Array.isArray(alerts)?alerts:[alerts],alerts.forEach(function(alert){emit(JOIN_EVENTS.hideAlert,alert)})}function validateEmailCallback(err,resp,body){return setRequestState(!1),err||200!==resp.status?displayAlert(JOIN_ALERTS.serverError,!0):body.exists?displayAlert(JOIN_ALERTS.accountExists,!0):void 0}function usernameExistsCallback(err,resp,body){return setRequestState(!1),err||200!==resp.status?displayAlert(JOIN_ALERTS.serverError,!0):body.exists?displayAlert(JOIN_ALERTS.usernameTaken,!0):void emit(JOIN_EVENTS.displayUsernameInput)}var emitter=new Emitter,JOIN_ALERTS={agreeToTerms:"agreeToTerms",accountExists:"accountExists",invalidEmail:"invalidEmail",invalidUsername:"invalidUsername",usernameTaken:"usernameTaken",serverError:"serverError"},JOIN_EVENTS={sendingRequest:"sendingRequest",displayAlert:"displayAlert",hideAlert:"hideAlert",displayUsernameInput:"displayUsernameInput",displayEmailInput:"displayEmailInput",displayWelcome:"displayWelcome"};return{on:function(event,listener){emitter.on(event,listener)},off:function(event,listener){return listener?void emitter.removeListener(event,listener):emitter.off(event)},start:function(){emit(JOIN_EVENTS.displayEmailInput)},validateEmail:function(email){clearAlerts([JOIN_ALERTS.invalidEmail,JOIN_ALERTS.accountExists,JOIN_ALERTS.serverError]);var valid=validation.isEmail(email);return valid?(setRequestState(!0),loginApi.uidExists(email,validateEmailCallback),!0):(displayAlert(JOIN_ALERTS.invalidEmail),!1)},submitEmail:function(agreeToTerms){return agreeToTerms?void emit(JOIN_EVENTS.displayUsernameInput):displayAlert(JOIN_ALERTS.agreeToTerms)},agreeToTermsChanged:function(agree){agree&&emit(JOIN_EVENTS.hideAlert,JOIN_ALERTS.agreeToTerms)},validateUsername:function(username){if(clearAlerts([JOIN_ALERTS.invalidUsername,JOIN_ALERTS.usernameTaken,JOIN_ALERTS.serverError]),username){var valid=validation.isUsername(username);if(!valid)return displayAlert(JOIN_ALERTS.invalidUsername);setRequestState(!0),loginApi.uidExists(username,usernameExistsCallback)}},submitUser:function(formData){clearAlerts([JOIN_ALERTS.agreeToTerms,JOIN_ALERTS.serverError]);var lang="en-US",html=document.querySelector("html");html.lang&&(lang=html.lang),setRequestState(!0),loginApi.createUser({email:formData.email,username:formData.username,mailingList:formData.subscribeToList,prefLocale:lang},function(err,resp,body){return setRequestState(!1),err||200!==resp.status?displayAlert(JOIN_ALERTS.serverError):(analytics.event("Webmaker New User Created",{nonInteraction:!0}),analytics.conversionGoal("WebmakerNewUserCreated"),void emit(JOIN_EVENTS.displayWelcome,body.user,showCTA))})}}}},{"../validation":17,"./emitter.js":10,"webmaker-analytics":4}],13:[function(require,module,exports){var Emitter=require("./emitter.js"),analytics=require("webmaker-analytics");module.exports=function(loginAPI){function emit(){emitter.emit.apply(emitter,arguments)}var emitter=new Emitter;return{on:function(event,listener){emitter.on(event,listener)},off:function(event,listener){emitter.off(event,listener)},logout:function(){loginAPI.logout(function(err,resp,body){return err||200!==resp.status?emit("logoutFailed"):(analytics.event("Webmaker Logout Clicked"),void emit("loggedOut"))})}}}},{"./emitter.js":10,"webmaker-analytics":4}],14:[function(require,module,exports){var Emitter=require("./emitter.js"),analytics=require("webmaker-analytics");module.exports=function(loginApi){function emit(){emitter.emit.apply(emitter,arguments)}var emitter=new Emitter,PERSONA_EVENTS={signedIn:"signedIn",newUser:"newUser"},analyticsLabel={label:"persona"};return{on:function(event,listener){emitter.on(event,listener)},off:function(event,listener){emitter.off(event,listener)},authenticate:function(){return window.navigator.id?(analytics.event("Persona Login Clicked"),void window.navigator.id.get(function(assertion){return assertion?void loginApi.personaLogin(assertion,function(err,resp,body){return err||200!==resp.status?void analytics.event("Webmaker Login Failed",analyticsLabel):(analytics.event("Webmaker Login Succeeded",analyticsLabel),void(body.user?emit(PERSONA_EVENTS.signedIn,body.user):body.email&&(analytics.event("Webmaker New User Started",analyticsLabel),emit(PERSONA_EVENTS.newUser,body.email))))}):void analytics.event("Webmaker Login Cancelled",analyticsLabel)})):console.error("No persona found. Did you load include.js?")}}}},{"./emitter.js":10,"webmaker-analytics":4}],15:[function(require,module,exports){var Emitter=require("./emitter.js"),validation=require("../validation"),analytics=require("webmaker-analytics");module.exports=function(loginApi){function emit(){emitter.emit.apply(emitter,arguments)}function setRequestState(state){emit(RESET_EVENTS.sendingRequest,state)}function displayAlert(alertId){emit(RESET_EVENTS.displayAlert,alertId)}function hideAlert(alertId){emit(RESET_EVENTS.hideAlert,alertId)}var emitter=new Emitter,RESET_ALERTS={passwordsMustMatch:"passwordsMustMatch",weakPassword:"weakPassword",serverError:"serverError"},RESET_EVENTS={sendingRequest:"sendingRequest",displayAlert:"displayAlert",hideAlert:"hideAlert",resetSucceeded:"resetSucceeded",passwordCheckResult:"passwordCheckResult",checkConfirmPassword:"checkConfirmPassword"};return{on:function(event,listener){emitter.on(event,listener)},off:function(event,listener){emitter.off(event,listener)},passwordsMatch:function(password,confimValue,blur){validation.passwordsMatch(password,confimValue)?(hideAlert(RESET_ALERTS.passwordsMustMatch),emit(RESET_EVENTS.checkConfirmPassword,!0)):(blur&&displayAlert(RESET_ALERTS.passwordsMustMatch),emit(RESET_EVENTS.checkConfirmPassword,!1))},checkPasswordStrength:function(password,blur){emit(RESET_EVENTS.passwordCheckResult,validation.checkPasswordStrength(password),blur)},submitResetRequest:function(uid,resetCode,password){hideAlert(RESET_ALERTS.serverError),hideAlert(RESET_ALERTS.weakPassword),setRequestState(!0),loginApi.resetPassword(uid,resetCode,password,function(err,resp,body){return setRequestState(!1),err||200!==resp.status?displayAlert(400===resp.status?RESET_ALERTS.weakPassword:RESET_ALERTS.serverError):(analytics.event("Webmaker Password Reset Succeeded"),void(window.location="/"))})}}}},{"../validation":17,"./emitter.js":10,"webmaker-analytics":4}],16:[function(require,module,exports){var Emitter=require("./emitter.js"),validation=require("../validation"),analytics=require("webmaker-analytics");module.exports=function(loginApi){function emit(){emitter.emit.apply(emitter,arguments)}function setRequestState(state){emit(SIGNIN_EVENTS.sendingRequest,state)}function displayAlert(alertId){emit(SIGNIN_EVENTS.displayAlert,alertId)}function hideAlert(alertId){emit(SIGNIN_EVENTS.hideAlert,alertId)}function clearAlerts(alerts){alerts=Array.isArray(alerts)?alerts:[alerts],alerts.forEach(function(alertId){hideAlert(alertId)})}var emitter=new Emitter,SIGNIN_ALERTS={paswordReset:"paswordReset",noAccount:"noAccount",invalidUid:"invalidUid",serverError:"serverError",invalidKey:"invalidKey",passwordSigninFailed:"passwordSigninFailed",resetRequestFailed:"resetRequestFailed"},SIGNIN_EVENTS={sendingRequest:"sendingRequest",displayAlert:"displayAlert",hideAlert:"hideAlert",displayEnterUid:"displayEnterUid",displayEnterPassword:"displayEnterPassword",displayEnterKey:"displayEnterKey",displayCheckEmail:"displayCheckEmail",displayResetSent:"displayResetSent",signedIn:"signedIn",displayEnterEmail:"displayEnterEmail"};return{on:function(event,listener){emitter.on(event,listener)},off:function(event,listener){emitter.off(event,listener)},start:function(){emit(SIGNIN_EVENTS.displayEnterUid)},submitUid:function(uid,path){clearAlerts([SIGNIN_ALERTS.invalidUid,SIGNIN_ALERTS.serverError,SIGNIN_ALERTS.noAccount]);var valid=validation.isEmail(uid)||validation.isUsername(uid);return valid?(setRequestState(!0),void loginApi.uidExists(uid,function(err,resp,body){if(setRequestState(!1),err||200!==resp.status)return displayAlert(SIGNIN_ALERTS.serverError);var isVerified=body.verified;return body.exists?!body.usePasswordLogin&&void loginApi.sendLoginKey(uid,path,function(err,resp,body){return err?displayAlert(SIGNIN_ALERTS.serverError):void(isVerified?emit(SIGNIN_EVENTS.displayEnterKey,!1):emit(SIGNIN_EVENTS.displayCheckEmail))}):displayAlert(SIGNIN_ALERTS.noAccount)})):displayAlert(SIGNIN_ALERTS.invalidUid)},displayEnterKey:function(){emit(SIGNIN_EVENTS.displayEnterKey,!0)},verifyKey:function(uid,key,rememberMe){clearAlerts([SIGNIN_ALERTS.serverError,SIGNIN_ALERTS.invalidKey]),setRequestState(!0);var validFor=rememberMe?"one-year":"";loginApi.verifyKey(uid,key,validFor,function(err,resp,body){return setRequestState(!1),err?displayAlert(SIGNIN_ALERTS.serverError):body.user?(analytics.event("Webmaker Login Succeeded",{label:"key"}),void emit(SIGNIN_EVENTS.signedIn,body.user)):displayAlert(SIGNIN_ALERTS.invalidKey)})},verifyPassword:function(uid,password,rememberMe){setRequestState(!0);var validFor=rememberMe?"one-year":"";loginApi.verifyPassword(uid,password,validFor,function(err,resp,body){return setRequestState(!1),err?displayAlert(SIGNIN_ALERTS.serverError):body.user?(analytics.event("Webmaker Login Succeeded",{label:"password"}),void emit(SIGNIN_EVENTS.signedIn,body.user)):displayAlert(SIGNIN_ALERTS.passwordSigninFailed)})},requestEmail:function(uid){setRequestState(!1),emit(SIGNIN_EVENTS.displayEnterEmail)},requestReset:function(uid){setRequestState(!0),loginApi.requestReset(uid,function(err,resp,body){return setRequestState(!1),err?displayAlert(SIGNIN_ALERTS.serverError):(hideAlert(SIGNIN_ALERTS.serverError),body.status?(hideAlert(SIGNIN_ALERTS.resetRequestFailed),analytics.event("Webmaker Password Reset Requested"),void emit(SIGNIN_EVENTS.displayResetSent)):displayAlert(SIGNIN_ALERTS.resetRequestFailed))})},getUidType:function(uid){return validation.isEmail(uid)?"email":validation.isUsername(uid)?"username":null}}}},{"../validation":17,"./emitter.js":10,"webmaker-analytics":4}],17:[function(require,module,exports){var usernameRegex=/^[a-zA-Z0-9\-]{1,20}$/,emailRegex=/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,containsBothCases=/^.*(?=.*[a-z])(?=.*[A-Z]).*$/,containsDigit=/\d/,MIN_PASSWORD_LEN=8;module.exports={isEmail:function(email){return emailRegex.test(email)},isUsername:function(username){return usernameRegex.test(username)},passwordsMatch:function(password,confirmation){return password===confirmation},checkPasswordStrength:function(password){if(!password)return!1;var lengthValid=password.length>=MIN_PASSWORD_LEN,caseValid=!!password.match(containsBothCases),digitValid=!!password.match(containsDigit);return{lengthValid:lengthValid,caseValid:caseValid,digitValid:digitValid}}}},{}]},{},[5]);